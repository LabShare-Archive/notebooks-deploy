#!/usr/bin/env bash

set -x

sudo yum update
sudo yum -y install nfs-utils

if [ ! -d /var/lib/jupyter ]; then
  sudo mkdir /var/lib/jupyter
  sudo chown hadoop /var/lib/jupyter
fi

#Create variables for source and target
DIR_SRC=$1
DIR_TGT=/var/lib/jupyter

#Mount EFS file system
sudo mount -t nfs4 -o nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2 $DIR_SRC:/ $DIR_TGT
sudo chmod go+rw $DIR_TGT

# Append line to fstab
echo -e "$DIR_SRC:/ \t\t $DIR_TGT \t\t nfs4 nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2 0 0" | sudo tee -a /etc/fstab